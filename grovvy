node {
    stage ("pull sporce code from github"){
        git branch: 'main', url: 'https://github.com/n3meshram/project1.git'
    }
    stage ("build docker file"){
        sh 'docker image build -t $JOB_NAME:v1.$BUILD_ID .'
        sh 'docker image tag $JOB_NAME:v1.$BUILD_ID nmeshram/$JOB_NAME:v1.$BUILD_ID'
        sh 'docker image tag $JOB_NAME:v1.$BUILD_ID nmeshram/$JOB_NAME:latest'
        
    }
    stage ("Push code in dockerHub"){
       withCredentials([string(credentialsId: 'newpassword', variable: 'my_password')]) {
    // some block
    sh 'echo "$my_password" | docker login --username nmeshram --password-stdin'
    sh 'docker image push nmeshram/$JOB_NAME:v1.$BUILD_ID'
    sh 'docker image push nmeshram/$JOB_NAME:latest'
    sh 'docker image rmi $JOB_NAME:v1.$BUILD_ID nmeshram/$JOB_NAME:v1.$BUILD_ID nmeshram/$JOB_NAME:latest'
}
    }
    stage ("depolyment of docker container"){
        def dockerrun = 'docker container run -p 9000:80 -d --name myweb nmeshram/scripted-pipeline:latest'
        sshagent(['dockerhostpassword']) {
    // some block
    sh "ssh -o StrictHostKeyChecking=no ec2-user@172.31.6.255 ${dockerrun}"
}
        
    }
}
